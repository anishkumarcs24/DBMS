CREATE DATABASE EMPLOYEE;
USE EMPLOYEE;

CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50) NOT NULL,
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50) NOT NULL,
    MGR_NO INT NULL,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    CONSTRAINT fk_emp_dept FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO),
    CONSTRAINT fk_emp_mgr FOREIGN KEY (MGR_NO) REFERENCES EMPLOYEE(EMPNO)
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PLOC VARCHAR(50),
    PNAME VARCHAR(100) NOT NULL
);

CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    CONSTRAINT fk_assigned_emp FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    CONSTRAINT fk_assigned_proj FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    PRIMARY KEY (EMPNO, INCENTIVE_DATE),
    CONSTRAINT fk_incentive_emp FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);

INSERT INTO DEPT VALUES 
(10, 'Research', 'Bengaluru'),
(20, 'Development', 'Hyderabad'),
(30, 'Marketing', 'Mysuru'),
(40, 'Sales', 'Bengaluru'),
(50, 'HR', 'Chennai'),
(60, 'Finance', 'Mumbai');

SELECT * FROM DEPT;

INSERT INTO EMPLOYEE VALUES 
(1001, 'Rajesh Kumar', NULL, '2020-01-15', 75000, 10),
(1004, 'Sneha Reddy', NULL, '2019-11-05', 80000, 20);

INSERT INTO EMPLOYEE VALUES
(1002, 'Priya Sharma', 1001, '2020-03-20', 65000, 10),
(1003, 'Amit Patel', 1001, '2021-05-10', 55000, 20),
(1005, 'Vikram Singh', 1004, '2021-08-22', 60000, 30),
(1006, 'Ananya Nair', 1004, '2022-02-14', 58000, 40),
(1007, 'Karthik Raj', 1001, '2020-07-18', 62000, 50);

INSERT INTO PROJECT VALUES
(101, 'Bengaluru', 'AI Research Project'),
(102, 'Hyderabad', 'Cloud Migration'),
(103, 'Mysuru', 'Mobile App Development'),
(104, 'Bengaluru', 'Data Analytics Platform'),
(105, 'Chennai', 'Cybersecurity Enhancement'),
(106, 'Mumbai', 'ERP Implementation');

INSERT INTO ASSIGNED_TO VALUES
(1001, 101, 'Project Manager'),
(1002, 101, 'Senior Developer'),
(1003, 102, 'Tech Lead'),
(1004, 102, 'Architect'),
(1005, 103, 'Developer'),
(1006, 104, 'Business Analyst'),
(1007, 105, 'Security Engineer');

INSERT INTO INCENTIVES VALUES
(1001, '2023-06-30', 15000),
(1002, '2023-06-30', 12000),
(1003, '2023-12-31', 10000),
(1004, '2023-06-30', 18000),
(1006, '2024-01-15', 8000),
(1007, '2023-12-31', 11000);

SELECT*FROM EMPLOYEE;
SELECT*FROM PROJECT;
SELECT*FROM ASSIGNED_TO;
SELECT*FROM INCENTIVES;

SELECT DISTINCT e.EMPNO
FROM EMPLOYEE e
JOIN ASSIGNED_TO a ON e.EMPNO = a.EMPNO
JOIN PROJECT p ON a.PNO = p.PNO
WHERE p.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');

SELECT EMPNO
FROM EMPLOYEE
WHERE EMPNO NOT IN (SELECT EMPNO FROM INCENTIVES);

SELECT
    e.ENAME,
    e.EMPNO,
    e.DEPTNO,
    a.JOB_ROLE,
    d.DLOC AS DEPARTMENT_LOCATION,
    p.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE e
JOIN DEPT d ON e.DEPTNO = d.DEPTNO
JOIN ASSIGNED_TO a ON e.EMPNO = a.EMPNO
JOIN PROJECT p ON a.PNO = p.PNO
WHERE d.DLOC = p.PLOC;
